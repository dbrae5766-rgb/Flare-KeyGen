<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flare - License Key Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* ===== ORIGINAL THEME (UNCHANGED) ===== */
        :root {
            --primary-orange: #ff6b35;
            --dark-bg: #1a1a1a;
            --darker-bg: #0f0f0f;
            --card-bg: #252525;
            --text-primary: #e0e0e0;
            --text-secondary: #888888;
            --border-color: #333333;
            --hover-bg: #2a2a2a;
            --success-green: #4ade80;
            --error-red: #f87171;
        }
        * { margin:0; padding:0; box-sizing:border-box }
        body {
            font-family:'Inter',sans-serif;
            background:var(--darker-bg);
            color:var(--text-primary);
        }
        .key-code {
            font-family:'Courier New',monospace;
            color:var(--primary-orange);
            cursor:pointer;
        }
        input.key-edit {
            font-family:'Courier New',monospace;
            color:var(--primary-orange);
            background:var(--dark-bg);
            border:1px solid var(--border-color);
            width:100%;
        }
    </style>
</head>

<body>

<div class="container">
    <div id="keysList"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, push, onValue, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
    apiKey: "AIzaSyAH5OnErkAOdDKYMvBTtl4F6jV_1C8Ut4Y",
    authDomain: "flare-key-gen.firebaseapp.com",
    databaseURL: "https://flare-key-gen-default-rtdb.firebaseio.com",
    projectId: "flare-key-gen",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.db = db;
window.dbRef = ref;
window.dbSet = set;
window.dbPush = push;
window.dbOnValue = onValue;
window.dbGet = get;

loadKeys();
</script>

<script>
/* ===== ADMIN IP SYSTEM (UNCHANGED) ===== */
const SPECIAL_IPS = ['69.170.112.226','175.37.240.44'];
let userIP = null;

async function checkUserIP() {
    const r = await fetch('https://api.ipify.org?format=json');
    const d = await r.json();
    userIP = d.ip;
}
checkUserIP();

function isAdminIP() {
    return SPECIAL_IPS.includes(userIP);
}

/* ===== LOAD KEYS ===== */
function loadKeys() {
    const keysRef = window.dbRef(window.db, 'keys');
    window.dbOnValue(keysRef, snap => {
        const list = document.getElementById('keysList');
        list.innerHTML = '';

        snap.forEach(child => {
            const k = child.val();
            const row = document.createElement('div');
            row.innerHTML = `
                <span class="key-code"
                    ondblclick="enableKeyEdit(this,'${child.key}')"
                    title="Double click to edit"
                >
                    ${k.key}
                </span>
            `;
            list.appendChild(row);
        });
    });
}

/* ===== INLINE EDIT (ADMIN = ANY STRING ALLOWED) ===== */
function enableKeyEdit(span, keyId) {
    if (!isAdminIP()) return;

    const input = document.createElement('input');
    input.className = 'key-edit';
    input.value = span.textContent.trim();

    span.replaceWith(input);
    input.focus();

    function save() {
        const newKey = input.value; // ANYTHING allowed

        window.dbSet(
            window.dbRef(window.db, `keys/${keyId}/key`),
            newKey
        );

        span.textContent = newKey;
        input.replaceWith(span);
    }

    input.addEventListener('keydown', e => {
        if (e.key === 'Enter') save();
        if (e.key === 'Escape') input.replaceWith(span);
    });

    input.addEventListener('blur', save);
}
</script>

</body>
</html>
